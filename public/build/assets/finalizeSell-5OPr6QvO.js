import{a as h}from"./bootstrap-OiABZ7MP.js";import{_ as f,o as a,c as n,a as e,d,i as c,t as r,w as u,A as g,F as y,e as b,v as w,b as k}from"./_plugin-vue_export-helper-bvfxiCSt.js";const M={props:["branch_id"],data(){return{name:"",err:null,method_payment_id:window.sale.method_payment_id??null,methodPayments:window.methodPayments,sale:window.sale,labelTitle:"Nro. Factura",isLoading:!1,invoice:!1,type:null,back_url:window.back_url,isLoadingReprint:!1,paymentMixedLabel:[],paymentMixed:{bolivares_efectivo:"",dolares_efectivo:"",pago_movil:"",biopago:"",punto_venta_venezuela:"",punto_venta_banesco:""}}},mounted(){this.methodPayments.length&&(this.method_payment_id=this.methodPayments[0].id,this.paymentMixedLabel=this.methodPayments.filter(i=>i.name!="MIXTO")),this.sale.delivery_notes&&this.sale.delivery_notes.length&&(this.sale.paid==0?this.labelTitle="Nro. de Nota de Despacho:":(this.labelTitle="Nro. de Entrega: ",this.type=""),this.type="notaEntrega"),this.sale.invoices&&this.sale.invoices.length&&(this.labelTitle="Nro. de Factura: ",this.type="invoice")},methods:{openModalFinalize(){$("#modalFinalizeSell").modal("show")},async reprint(){this.isLoadingReprint=!0;try{await this.apiReprint()}catch(i){console.error(i)}finally{}},async apiReprint(){const i=window.impresora;h.post(i,{data:this.sale}).then(o=>{}),setTimeout(()=>{window.location.reload()},2e3)},async finalizeSell(){this.isLoading=!0;try{await this.apiPost()}catch(i){console.error(i)}finally{}},async apiPost(){const i={method_payment_id:this.method_payment_id,paid:1};for(let o in this.paymentMixed)this.paymentMixed[o]&&(i.paymentMixed=this.paymentMixed);h.post("/api/finalizar/"+this.sale.id,i).then(o=>{const{data:_,success:p}=o.data;if(p){const t=window.impresora;h.post(t,{data:_}).then(l=>{})}else this.err=_;setTimeout(()=>{window.location.reload()},2e3)}).catch(o=>{console.log(o)})},checkPaymentMethod(){this.method_payment_id!=9&&(this.paymentMixed={bolivares_efectivo:"",dolares_efectivo:"",pago_movil:"",biopago:"",punto_venta_venezuela:"",punto_venta_banesco:""})}}},x={class:"row"},z={class:"col-md-6"},L={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},P={key:1},F=e("i",{class:"fas fa-print"},null,-1),S=[F],T={class:"col-md-6"},N={id:"modalFinalizeSell",class:"modal",tabindex:"-1",role:"dialog","data-backdrop":"static"},C={class:"modal-dialog modal-md",role:"document"},R={class:"modal-content"},V={class:"modal-header"},B={class:"modal-title"},D={class:"font-weight-bold"},E={class:"font-weight-bold"},U=e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")],-1),A={class:"modal-body"},I={class:"row mb-2"},O={class:"col-12"},X=e("label",{for:"method_payment_id"},"Método de pago",-1),j=["disabled"],q=["value"],G={key:0,class:"row mb-2 mt-4 ml-4"},H={class:"row"},J={class:"col-6"},K={class:"col-6"},Q=["placeholder","onUpdate:modelValue"],W={class:"modal-footer"},Y=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ee={key:1};function te(i,o,_,p,t,l){return a(),n("div",null,[e("div",x,[e("div",z,[e("h5",null,[t.sale.paid==0&&i.cancel_sale==0?d("",!0):(a(),n("button",{key:0,type:"button",class:"btn btn-sm btn-default mr-2",onClick:o[0]||(o[0]=(...s)=>l.reprint&&l.reprint(...s))},[t.isLoadingReprint?(a(),n("span",L)):d("",!0),t.isLoadingReprint?d("",!0):(a(),n("span",P,S))])),c(" "+r(t.labelTitle)+" "+r(t.sale.uuid),1)])]),e("div",T,[t.sale.paid==0&&!t.sale.cancel_sale?(a(),n("button",{key:0,type:"button",class:"btn btn-sm btn-primary float-right",onClick:o[1]||(o[1]=(...s)=>l.openModalFinalize&&l.openModalFinalize(...s))},"Finalizar venta")):d("",!0)])]),e("div",N,[e("div",C,[e("div",R,[e("div",V,[e("h5",B,[c(" Pagar Bs. "),e("span",D,r(t.sale.total_bs),1),c("    -    Pagar "),e("span",E,"$ "+r(t.sale.total_dolares),1)]),U]),e("div",A,[e("div",I,[e("div",O,[X,u(e("select",{onChange:o[2]||(o[2]=(...s)=>l.checkPaymentMethod&&l.checkPaymentMethod(...s)),"onUpdate:modelValue":o[3]||(o[3]=s=>t.method_payment_id=s),id:"mySelect",class:"form-control",disabled:!!t.isLoading},[(a(!0),n(y,null,b(t.methodPayments,(s,m)=>(a(),n("option",{key:m,value:s.id},r(s.name),9,q))),128))],40,j),[[g,t.method_payment_id]])])]),t.method_payment_id==9?(a(),n("div",G,[(a(!0),n(y,null,b(t.paymentMixedLabel,(s,m)=>(a(),n("div",{key:m,class:"col-12"},[e("div",H,[e("div",J,[e("label",null,r(s.name),1)]),e("div",K,[u(e("input",{size:"5",placeholder:s.currency,class:"ml-1",type:"text","onUpdate:modelValue":v=>t.paymentMixed[s.slug]=v},null,8,Q),[[w,t.paymentMixed[s.slug]]]),c(" "+r(s.currency),1)])])]))),128))])):d("",!0)]),e("div",W,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:o[4]||(o[4]=(...s)=>l.finalizeSell&&l.finalizeSell(...s)),disabled:t.isLoading},[t.isLoading?(a(),n("span",Z)):d("",!0),t.isLoading?d("",!0):(a(),n("span",ee,"Finalizar venta"))],8,Y)])])])])])}const se=f(M,[["render",te]]);k(se).mount("#finalizeSell");
